# Validation Levels Configuration
# 
# This file defines the validation gates that must pass
# before the Ralph loop can complete.

levels:
  # Level 1: Syntax & Style (REQUIRED)
  # Must pass after every code change
  syntax:
    required: true
    commands:
      # JavaScript/TypeScript
      - condition: "[ -f package.json ]"
        run: "npm run lint --silent"
        name: "ESLint"
      - condition: "[ -f tsconfig.json ]"
        run: "npm run typecheck --silent || npx tsc --noEmit"
        name: "TypeScript"
      # Python
      - condition: "[ -f pyproject.toml ] || [ -f requirements.txt ]"
        run: "ruff check . --fix"
        name: "Ruff"
      - condition: "[ -f pyproject.toml ]"
        run: "mypy ."
        name: "MyPy"
      # Rust
      - condition: "[ -f Cargo.toml ]"
        run: "cargo check"
        name: "Cargo Check"
        
  # Level 2: Unit Tests (REQUIRED)
  # Must pass before phase completion
  unit_tests:
    required: true
    commands:
      # JavaScript/TypeScript
      - condition: "[ -f package.json ]"
        run: "npm run test:unit --silent || npm run test --silent"
        name: "Jest/Vitest"
      # Python
      - condition: "[ -f pyproject.toml ]"
        run: "uv run pytest tests/unit -v"
        name: "Pytest Unit"
      # Rust
      - condition: "[ -f Cargo.toml ]"
        run: "cargo test --lib"
        name: "Cargo Test"
        
  # Level 3: Integration Tests (OPTIONAL)
  # Run at final completion check
  integration:
    required: false
    commands:
      - condition: "[ -f package.json ]"
        run: "npm run test:integration --silent || npm run test:e2e --silent"
        name: "Integration Tests"
      - condition: "[ -f pyproject.toml ]"
        run: "uv run pytest tests/integration -v"
        name: "Pytest Integration"
        
  # Level 4: Build (OPTIONAL)
  # Verify project still builds
  build:
    required: false
    commands:
      - condition: "[ -f package.json ]"
        run: "npm run build --silent"
        name: "Build"
      - condition: "[ -f Cargo.toml ]"
        run: "cargo build --release"
        name: "Cargo Build"

# Validation runner script
# Run: .kiro/workflows/validate.sh [level]
runner: |
  #!/bin/bash
  LEVEL=${1:-syntax}
  CONFIG=".kiro/validation/levels.yaml"
  
  run_level() {
    local level=$1
    echo "Running validation level: $level"
    
    # Parse YAML and run matching commands
    # (In practice, use yq or Python for YAML parsing)
  }
  
  case $LEVEL in
    syntax)
      run_level syntax
      ;;
    unit)
      run_level syntax
      run_level unit_tests
      ;;
    integration)
      run_level syntax
      run_level unit_tests
      run_level integration
      ;;
    all)
      run_level syntax
      run_level unit_tests
      run_level integration
      run_level build
      ;;
    *)
      echo "Unknown level: $LEVEL"
      echo "Available: syntax, unit, integration, all"
      exit 1
      ;;
  esac
